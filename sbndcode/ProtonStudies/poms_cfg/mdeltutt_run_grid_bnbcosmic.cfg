[global]
group = sbnd
experiment = sbnd
wrapper = file:///${FIFE_UTILS_DIR}/libexec/fife_wrap
account = mdeltutt
file_type = data
run_type = physics
b_name = %(project_name)s
basename = override_me
larsoft_tag = override_me
larsoft_qual = override_me
sam_dataset = override_me
fcl = override_me
numevents = override_me
startevent = 1
outdir = override_me
logdir = override_me
streamname = only
fcl_list = override_me
stage_name = override_me
artRoot_dataset = %(account)s_%(project_name)s_%(stage_name)s_20241111_173301_628289
histRoot_dataset = %(account)s_hist_%(project_name)s_%(stage_name)s_20241111_173301_628296
project_name = mdeltutt_protonana_bnbcosmic
release = v09_91_02_01
releasetag = e26:prof
my_version = v1
my_run = 1
PNFSpath = /pnfs/sbnd/resilient/users/mdeltutt/
SCRATCHpath = /pnfs/sbnd/scratch/users/mdeltutt/

[env_pass]
IFDH_DEBUG = 1
SAM_EXPERIMENT = %(experiment)s
ARTROOT_DATASET = %(artRoot_dataset)s
HISTROOT_DATASET = %(histRoot_dataset)s

[prelaunch]
script = source /cvmfs/larsoft.opensciencegrid.org/products/setups; source /cvmfs/fermilab.opensciencegrid.org/products/common/etc/setups; setup project_py; ups active; Project.py --prestage --defname %(sam_dataset)s --experiment sbnd 

[submit]
G = %(group)s
e = SAM_EXPERIMENT
e_1 = IFDH_DEBUG
e_2 = POMS4_CAMPAIGN_NAME
e_3 = POMS4_CAMPAIGN_STAGE_NAME
e_4 = ARTROOT_DATASET
e_5 = HISTROOT_DATASET
line = '+SingularityImage=\"/cvmfs/singularity.opensciencegrid.org/fermilab/fnal-wn-sl7:latest\"'
append_condor_requirements = '(TARGET.HAS_SINGULARITY=?=true)'
resource-provides = override_me
generate-email-summary = True
expected-lifetime = 8h
disk = 10GB
memory = 2000MB
email-to = %(account)s@fnal.gov

[job_setup]
debug = True
find_setups = True
source_1 = /cvmfs/%(experiment)s.opensciencegrid.org/products/%(experiment)s/setup_%(experiment)s.sh
setup_1 = %(experiment)scode %(larsoft_tag)s -q %(larsoft_qual)s

[sam_consumer]
limit = 1
schema = root
appvers = %(larsoft_tag)s
appfamily = art
appname = test

[job_output]
addoutput = %(basename)s*.root
rename = unique
dest = %(outdir)s
hash = 2
declare_metadata = True
metadata_extractor = sam_metadata_dumper
add_location = True
filter_metadata = data_stream
filter_metadata_2 = art.run_type
filter_metadata_3 = art.file_format_era
filter_metadata_4 = art.last_event
filter_metadata_5 = art.process_name
filter_metadata_6 = art.first_event
filter_metadata_7 = art.file_format_version

[job_output_1]
addoutput = hist_%(basename)s*.root
rename = unique
dest = %(outdir)s
hash = 2
declare_metadata = True
add_location = True

[job_output_2]

[stage_ana]
job_output.add_to_dataset = %(artRoot_dataset)s
job_output.dataset_exclude = hist*
job_output_1.add_to_dataset = %(histRoot_dataset)s
global.numevents = 100000
global.larsoft_tag = %(release)s
global.larsoft_qual = %(releasetag)s
job_setup.setup_local = True
submit.tar_file_name = %(PNFSpath)sTarballs/sbndcode_%(release)s_protonana__%(my_version)s.tgz
global.fcl = \${CONDOR_DIR_INPUT}/run_protonanalyzer.fcl
executable.name = lar
job_output.addoutput = %(basename)s_*.root
job_output_1.addoutput = hist_%(basename)s_*.root
global.fcl_list = run_protonanalyzer.fcl
global.basename = %(b_name)s_%(larsoft_tag)s_ana
global.numjobs = 2
global.outdir = %(SCRATCHpath)s/%(release)s/protonana_ana_bnbcosmic_%(my_version)s_%(my_run)s
submit.disk = 50GB
submit.memory = 8000MB
submit.resource-provides = usage_model=DEDICATED,OPPORTUNISTIC,OFFSITE
submit.n_files_per_job = 1
submit.dataset = official_MCP2024B_prodoverlay_corsika_cosmics_proton_genie_rockbox_sce_reco2_sbnd
job_setup.ifdh_art = True
sam_consumer.limit = 1
executable.arg_7 = 
executable.arg_8 = 
executable.arg_11 = 
executable.arg_12 = 
global.stage_name = ana
submit.expected-lifetime = 6h
submit.Q = True
submit.generate-email-summary = True
submit.l_2 =  +SingularityImage=\"/cvmfs/singularity.opensciencegrid.org/fermilab/fnal-wn-sl7:latest\"
submit.append_condor_requirements_2 = '(TARGET.HAS_SINGULARITY=?=true)'
submit.f = dropbox://${UPLOADS}/run_protonanalyzer.fcl

[executable]
name = true
arg_1 = -c
arg_2 = %(fcl)s
arg_3 = -o
arg_4 = %(basename)s_\${CLUSTER}_\${PROCESS}.root
arg_5 = -n
arg_6 = %(numevents)s
arg_7 = -e
arg_8 = 1:0:%(startevent)s
arg_9 = -T
arg_10 = hist_%(basename)s_\${CLUSTER}_\${PROCESS}.root
arg_11 = -s
arg_12 = input_filename ## will be added by multifile loop...

